@{
    ViewData["Title"] = "الطلاب";
}

<style>
    body {
        direction: rtl;
        background-color: #2c3e50; /* لون أزرق داكن */
        color: #ecf0f1; /* لون النص فاتح */
    }

    .form-container {
        max-width: 1200px;
        margin: 20px auto;
        background: #34495e; /* لون أزرق مائل للرمادي */
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    .form-label {
        color: #f1c40f; /* لون ذهبي */
    }

    .form-control, .form-select, textarea {
        background-color: #2c3e50;
        color: #ecf0f1;
        border: 1px solid #f1c40f;
    }

    .form-control::placeholder {
        color: #bdc3c7;
    }

    .btn-primary {
        background-color: #f1c40f;
        border: none;
        color: #2c3e50;
        font-weight: bold;
    }

    .btn-primary:hover {
        background-color: #d4ac0d;
    }

    .btn-danger, .btn-warning {
        font-weight: bold;
    }
</style>

<div class="container-fluid">
    <div class="form-container">
        <h3 class="text-center mb-4">نموذج تسجيل طالب</h3>
        <input type="hidden" class="form-control" id="Idhidin">
        <form id="studentForm" class="container">
            <h5 class="mb-3 col-12">المعلومات الأساسية</h5>
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="fullName" class="form-label">الاسم الكامل</label>
                    <input type="text" class="form-control" id="fullName" >
                </div>
                <div class="col-md-4">
                    <label for="nameFather" class="form-label">اسم الأب</label>
                    <input type="text" class="form-control" id="nameFather" >
                </div>
                <div class="col-md-4">
                    <label for="nameMother" class="form-label">اسم الأم</label>
                    <input type="text" class="form-control" id="nameMother" >
                </div>
                <div class="col-md-4">
                    <label for="birthDate" class="form-label"> العمر</label>
                    <input type="number" class="form-control" id="birthDate" >
                </div>
                <div class="col-md-4">
                    <label for="gender" class="form-label">الجنس</label>
                    <select class="form-select" id="gender" >
                        <option value="">اختر...</option>
                        <option value="ذكر">ذكر</option>
                        <option value="أنثى">أنثى</option>
                    </select>
                </div>
            </div>

            <h5 class="mt-4 mb-3 col-12">معلومات الاتصال</h5>
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="email" class="form-label">البريد الإلكتروني</label>
                    <input type="email" class="form-control" id="email" >
                </div>
                <div class="col-md-4">
                    <label for="phoneNumber" class="form-label">رقم الهاتف</label>
                    <input type="tel" class="form-control" id="phoneNumber" >
                </div>
                <div class="col-md-4">
                    <label for="phoneNumberFather" class="form-label">رقم هاتف الأب</label>
                    <input type="tel" class="form-control" id="phoneNumberFather" >
                </div>
                <div class="col-md-12">
                    <label for="address" class="form-label">العنوان</label>
                    <input type="text" class="form-control" id="address" >
                </div>
            </div>

            <h5 class="mt-4 mb-3 col-12">المعلومات الأكاديمية</h5>
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="grade" class="form-label">الصف الدراسي</label>
                    <input type="text" class="form-control" id="grade" >
                </div>
                <div class="col-md-4">
                    <label for="class" class="form-label">الفصل</label>
                    <input type="text" class="form-control" id="class" >
                </div>
                <div class="col-md-4">
                    <label for="schoolName" class="form-label">اسم المدرسة</label>
                    <input type="text" class="form-control" id="schoolName" >
                </div>
                <div class="col-md-12">
                    <label for="studentNumber" class="form-label">رقم الطالب</label>
                    <input type="text" class="form-control" id="studentNumber" >
                </div>

                <div class="col-md-12">
                    <label for="studentNumber" class="form-label">سلوك الطالب</label>
                    <input type="text" class="form-control" id="Behavior">
                </div>

                <div class="col-md-12">
                    <label for="studentNumber" class="form-label">مستوى الدراسي الطالب</label>
                    <input type="text" class="form-control" id="educationallevel">
                </div>
            </div>

            <h5 class="mt-4 mb-3 col-12">معلومات إضافية</h5>
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="skills" class="form-label">المهارات</label>
                    <input type="text" class="form-control" id="skills">
                </div>
                <div class="col-md-4">
                    <label for="hobbies" class="form-label">الهوايات</label>
                    <input type="text" class="form-control" id="hobbies">
                </div>
                <div class="col-md-4">
                    <label for="healthStatus" class="form-label">الحالة الصحية</label>
                    <input type="text" class="form-control" id="healthStatus">
                </div>
                <div class="col-md-4">
                    <label for="healthStatus" class="form-label"> مهنة الطالب</label>
                    <input type="text" class="form-control" id="JobStudin">
                </div>
                <div class="col-md-12">
                    <label for="notes" class="form-label">ملاحظات</label>
                    <textarea class="form-control" id="notes" rows="3"></textarea>
                </div>
            </div>

            <button type="submit" id="sendstuding" class="btn btn-primary w-100 mt-4">إرسال</button>
            <button type="button" id="Editstuding" class="btn btn-primary w-100 mt-4">تعديل </button>
            <button type="button" id="Dletestuding" class="btn btn-primary w-100 mt-4">حذف</button>
        </form>

       
    </div>
</div>

<script>
    document.getElementById("sendstuding").addEventListener("click", function (e) {
        e.preventDefault(); // لمنع إعادة تحميل الصفحة
    
        // جمع بيانات الفورم
        var studentData = {
            fullName: document.getElementById("fullName").value,
            nameFather: document.getElementById("nameFather").value,
            nameMother: document.getElementById("nameMother").value,
            age: document.getElementById("birthDate").value,
            gender: document.getElementById("gender").value,
            email: document.getElementById("email").value,
            phoneNumber: document.getElementById("phoneNumber").value,
            phoneNumberFather: document.getElementById("phoneNumberFather").value,
            address: document.getElementById("address").value,
            grade: document.getElementById("grade").value,
            class: document.getElementById("class").value,
            schoolName: document.getElementById("schoolName").value,
            studentNumber: document.getElementById("studentNumber").value,
            skills: document.getElementById("skills").value,
            hobbies: document.getElementById("hobbies").value,
            healthStatus: document.getElementById("healthStatus").value,
            Behavior: document.getElementById("Behavior").value,
            educationallevel: document.getElementById("educationallevel").value,
            JobStudin: document.getElementById("JobStudin").value,
            notes: document.getElementById("notes").value,
        };

        $.ajax({
            url: `/Studint/Savestudint`, // تأكد من أن المسار صحيح
            type: "POST",
            data: JSON.stringify(studentData), // تحويل الكائن إلى JSON
            contentType: "application/json", // تحديد نوع المحتوى
            success: function (response) {
                Swal.fire({
                    title: "تمت الإضافة!",
                    text: "تمت إضافة الطالب بنجاح",
                    icon: "success",
                    confirmButtonText: "موافق"
                });

                clearFormValues()
            },
            error: function (xhr) {
                Swal.fire({
                    title: "خطأ!",
                    text: "حدث خطأ أثناء الإضافة: " + xhr.responseText,
                    icon: "error",
                    confirmButtonText: "حسناً"
                });
            }
        });
    });




    $(document).ready(function () {
        function checkIdInUrl() {
            console.log("🔍 البحث عن id في URL...");
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get("id"); // جلب قيمة id من الرابط

            if (id) {
                console.log("📌 الـ ID الموجود في الرابط هو:", id);

                $.ajax({
                    url: `/Studint/GetById/${id}`, // استدعاء API لجلب بيانات الطالب
                    type: "GET",
                    success: function (response) {
                        console.log("✅ البيانات المستلمة:", response);

                        // تعبئة الفورم بالبيانات
                        $("#Idhidin").val(response.id);
                        $("#fullName").val(response.fullName);
                        $("#nameFather").val(response.nameFather);
                        $("#nameMother").val(response.nameMother);
                        $("#birthDate").val(response.age);
                        $("#gender").val(response.gender);
                        $("#email").val(response.email);
                        $("#phoneNumber").val(response.phoneNumber);
                        $("#phoneNumberFather").val(response.phoneNumberFather);
                        $("#address").val(response.address);
                        $("#grade").val(response.grade);
                        $("#class").val(response.class);
                        $("#schoolName").val(response.schoolName);
                        $("#studentNumber").val(response.studentNumber);
                        $("#Behavior").val(response.behavior);
                        $("#educationallevel").val(response.educationallevel);
                        $("#skills").val(response.skills);
                        $("#hobbies").val(response.hobbies);
                        $("#healthStatus").val(response.healthStatus);
                       
                        $("#JobStudin").val(response.jobStudin);
                        $("#notes").val(response.notes);
                    },
                    error: function (xhr) {
                        Swal.fire({
                            title: "خطأ!",
                            text: "حدث خطأ أثناء جلب البيانات: " + xhr.responseText,
                            icon: "error",
                            confirmButtonText: "حسناً"
                        });
                    }
                });

                // إخفاء زر الإرسال وعرض أزرار التعديل والحذف
                $("#sendstuding").hide();
                $("#Editstuding, #Dletestuding").show();
            } else {
                // عرض زر الإرسال فقط إذا لم يكن هناك ID
                $("#sendstuding").show();
                $("#Editstuding, #Dletestuding").hide();
            }
        }

        checkIdInUrl();
    });


    document.getElementById("Editstuding").addEventListener("click", function (e) {
        e.preventDefault(); // لمنع إعادة تحميل الصفحة
        // استدعاء الدالة للتحقق من وجود id في الـ URL
       
        // جمع بيانات الفورم
        var studentData = {
            id: document.getElementById("Idhidin").value,
            fullName: document.getElementById("fullName").value,
            nameFather: document.getElementById("nameFather").value,
            nameMother: document.getElementById("nameMother").value,
            age: document.getElementById("birthDate").value,
            gender: document.getElementById("gender").value,
            email: document.getElementById("email").value,
            phoneNumber: document.getElementById("phoneNumber").value,
            phoneNumberFather: document.getElementById("phoneNumberFather").value,
            address: document.getElementById("address").value,
            grade: document.getElementById("grade").value,
            class: document.getElementById("class").value,
            schoolName: document.getElementById("schoolName").value,
            studentNumber: document.getElementById("studentNumber").value,
            skills: document.getElementById("skills").value,
            hobbies: document.getElementById("hobbies").value,
            healthStatus: document.getElementById("healthStatus").value,
            Behavior: document.getElementById("Behavior").value,
            educationallevel: document.getElementById("educationallevel").value,
            JobStudin: document.getElementById("JobStudin").value,
            notes: document.getElementById("notes").value,
        };

        $.ajax({
            url: `/Studint/Edit`, // تأكد من أن المسار صحيح
            type: "POST",
            data: JSON.stringify(studentData), // تحويل الكائن إلى JSON
            contentType: "application/json", // تحديد نوع المحتوى
            success: function (response) {
                Swal.fire({
                    title: "تمت الإضافة!",
                    text: "تمت تعديل الطالب بنجاح",
                    icon: "success",
                    confirmButtonText: "موافق"
                });

                clearFormValues()
            }, 
            error: function (xhr) {
                Swal.fire({
                    title: "خطأ!",
                    text: "حدث خطأ أثناء الإضافة: " + xhr.responseText,
                    icon: "error",
                    confirmButtonText: "حسناً"
                });
            }
        });
    });




    document.getElementById("Dletestuding").addEventListener("click", function (e) {
        e.preventDefault();
  
        Swal.fire({
            title: "هل أنت متأكد؟",
            text: "لن تتمكن من استعادة بيانات الطالب بعد الحذف!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#d33",
            cancelButtonColor: "#3085d6",
            confirmButtonText: "نعم، احذف!",
            cancelButtonText: "إلغاء"
        }).then((result) => {
            if (result.isConfirmed) {
                // تنفيذ الحذف بعد التأكيد
                var studentId = document.getElementById("Idhidin").value;

                $.ajax({
                    url: `/Studint/Delete/${studentId}`, // تأكد من أن المسار صحيح للحذف
                    type: "DELETE", // استخدم DELETE بدلاً من POST
                    success: function (response) {
                        Swal.fire({
                            title: "تم الحذف!",
                            text: "تم حذف الطالب بنجاح",
                            icon: "success",
                            confirmButtonText: "موافق"
                        });

                        clearFormValues()
                    },
                    error: function (xhr) {
                        Swal.fire({
                            title: "خطأ!",
                            text: "حدث خطأ أثناء الحذف: " + xhr.responseText,
                            icon: "error",
                            confirmButtonText: "حسناً"
                        });
                    }
                });
            }
        });
    });



    function clearFormValues() {
        document.getElementById('fullName').value = '';
        document.getElementById('nameFather').value = '';
        document.getElementById('nameMother').value = '';
        document.getElementById('birthDate').value = '';
        document.getElementById('gender').value = '';
        document.getElementById('email').value = '';
        document.getElementById('phoneNumber').value = '';
        document.getElementById('phoneNumberFather').value = '';
        document.getElementById('address').value = '';
        document.getElementById('grade').value = '';
        document.getElementById('class').value = '';
        document.getElementById('schoolName').value = '';
        document.getElementById('studentNumber').value = '';
        document.getElementById('Behavior').value = '';
        document.getElementById('educationallevel').value = '';
        document.getElementById('skills').value = '';
        document.getElementById('hobbies').value = '';
        document.getElementById('healthStatus').value = '';
        document.getElementById('JobStudin').value = '';
        document.getElementById('notes').value = '';
    }
</script>





